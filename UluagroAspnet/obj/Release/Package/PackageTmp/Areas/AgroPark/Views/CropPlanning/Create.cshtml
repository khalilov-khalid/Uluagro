@*@model UluagroAspnet.Models.PLANNINGPLANDETAIL*@
@{
    ViewBag.Title = "Create";
    Layout = "~/Areas/AgroPark/Views/Shared/_AdminLayout.cshtml";
}

@using (Html.BeginForm())
{
    <div class="container">
        <div class="row">
            <div class="col-md-12 mb-2 d-flex justify-content-between">
                <h4>Yeni plan əlavə et.</h4>
                <a href="@Url.Action("Index","CropPlanning")" class="u_btn go_b_btn">Geri qayıt</a>
            </div>
            <div class="col-md-12 d-flex justify-content-center">
                @if (ViewBag.CreateError != null)
                {
                    <div class="alert alert-danger">
                        <p>@ViewBag.CreateError</p>
                    </div>
                }
            </div>
            <hr />

            @* Kateqoriya *@
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label">Kateqoriya</label>
                    <div>
                        <select class="form-control" id="category" required>
                            <option value="" disabled selected>Seçin</option>
                            @foreach (var item in ViewBag.Categories)
                            {
                                <option value="@item.OBJECTID">@item.NAME</option>
                            }
                        </select>
                    </div>
                </div>
            </div>

            @* Bitkiler *@
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label">Bitki</label>
                    <select class="form-control" id="crops" required>
                        <option value="" selected disabled>Seçin</option>
                    </select>
                </div>
            </div>

            @* Sortlar *@
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label" for="CROPSORTID">Bitki sortu</label>
                    <select class="form-control" id="CROPSORTID" name="CROPSORTID" required>
                        <option value="" selected>Seçin</option>
                    </select>
                </div>
            </div>

            @* Keyfiyyet derecesi *@
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label">Keyfiyyət dərəcəsi</label>
                    <div>
                        <select name="CROPREPRODUCTIONID" class="form-control" required>
                            <option selected disabled value="">Seçin</option>
                            @foreach (var item in ViewBag.CropReps)
                            {
                                <option value="@item.OBJECTID">@item.NAME</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="add_new_plan">
            <button type="button" class="plan_add" title="Yeni plan əlavə et">+</button>
        </div>

        <hr />

        <div id="all_work_con">
            <div class="row work_n pb-2 pt-2">
                @* Aylar *@
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="control-label" for="MONTH">Ay</label>
                        <select class="form-control months" id="MONTH" name="MONTH" required>
                            <option selected disabled value="">Seçin</option>
                        </select>
                    </div>
                </div>

                @* Gorulecek isler *@
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="control-label" for="WORKCANDO">Görüləcək işlər</label>
                        <input class="form-control" type="text" name="WORKCANDO" value="" id="WORKCANDO" placeholder="İşləri daxil edin..." required/>
                    </div>
                </div>

                @* Lazimli *@
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="control-label" for="NEEDED">Lazımlı ehtiyyat</label>
                        <input class="form-control" type="text" name="NEEDED" value="" id="NEEDED" placeholder="Ehtiyatı daxil edin..." required/>
                    </div>
                </div>

                @* Qiymet *@
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="control-label" for="PRICE">Qiymət</label>
                        <input class="form-control" type="number" step=0.01 name="PRICE" value="" id="PRICE" placeholder="Qiyməti daxil edin..." required/>
                    </div>
                </div>

                @* Remove *@
                <div class="col-md-1 d-flex justify-content-center align-items-center">
                    <button type="button" class="plan_remove" title="Planı sil">-</button>
                </div>
            </div>
        </div>

        <hr />

        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <div class="d-flex justify-content-center">
                        <input type="submit" value="Əlavə et" class="u_btn sbm_btn" />
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section scripts
{
    <script>
        var months = ["Yanvar", "Fevral", "Mart", "Aprel", "May", "iyun", "Iyul", "Avqust", "Sentyabr", "Oktyabr", "Noyabr", "Dekabr"];

        //Load Selectbox of Months
        function loadmonths() {
            $(".months option").remove();
            $(".months").append("<option selected disabled value=''>Seçin</option>")
            for (var i = 0; i < months.length; i++) {
                $(".months").append("<option value='" + months[i] + "'>" + months[i] + "</option>")
            }
        }

        $(document).ready(loadmonths);

        //Load Crops for selection
        $("#category").change(function () {
            $.ajax({
                url: "/CropPlanning/LoadCrops",
                method: "get",
                data: { id: $(this).val()},
                type: "JSON",
                success: function (response) {
                    $("#crops option").remove();
                    $("#crops").append("<option selected disabled value=''>Seçin</option>");
                    if (response!=null) {
                        for (var i = 0; i < response.length; i++) {
                            $("#crops").append("<option value='" + response[i].OBJECTID + "'>" + response[i].NAME + "</option>")
                        }
                    }
                }
            })
        });

        //Load CropSort for selection
        $("#crops").change(function () {
            $.ajax({
                url: "/CropPlanning/LoadCropSorts",
                method: "get",
                data: { id: $(this).val()},
                type: "JSON",
                success: function (response) {
                    $("#CROPSORTID option").remove();
                    $("#CROPSORTID").append("<option selected value=''>Seçin</option>");
                    if (response!=null) {
                        for (var i = 0; i < response.length; i++) {
                            $("#CROPSORTID").append("<option value='" + response[i].OBJECTID + "'>" + response[i].NAME + "</option>")
                        }
                    }
                }
            })
        })

        $(".plan_add").click(function () {
            $.ajax({
                url: "/CropPlanning/AddPlan",
                method: "get",
                type: "JSON",
                success: function (response) {
                    $("#all_work_con").append(response);
                    loadmonths();
                }
            })
        })

        $(document).on("click", ".plan_remove", function () {
            $(this).parents(".work_n").remove();
        });
    </script>
}